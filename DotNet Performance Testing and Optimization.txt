Chapter 1: Introduction â€“ The What and the Why
    Performance testing
    Load testing
    Stress testing
    Profiling
    Cost benefits of performance and load testing
        Example scenarios
    Sometimes, what seems right can be wrong
    Conclusion
Chapter 2: Understanding Performance Targets
    Identifying performance targets
    Structuring test breakdowns
    Determining what load to target
    Contingency in your estimations
    Estimate the mix of browsers for your web application
    What data do we measure?
    Time to First Byte
        Total page response time
        What about average response time?
        Sweet spots and operational ceilings
    Conclusion
Chapter 3: Performance and Load Test Metrics
    What metrics do we need?
    Basic metrics
Web application basic metrics
What to look for
CPU utilization
Memory utilization
Response time
Creating a baseline
Using Visual Studio to analyze the results
Using the Test Results management window
Using the Open and Manage Test Results dialog
Filtering performance test result selection
Sweet spots and operational ceilings
Detailed performance metrics
Performance metrics
What do I do with all this information?
Conclusion
Chapter 4: Implementing Your Test Rig
Creating the performance test rig
Architecture and structure of a performance test rig
Role breakdown
Setting up and configuration
Port setup and firewall considerations
Network segmentation/isolation
Controller setup
Creating the load test database
Guest policy on Windows XP in workgroup mode
Agent setup
Workstation setup
Troubleshooting the controller and agents
Setting up performance counter collection
Conclusion
Chapter 5: Creating Performance Tests
Basic solution structure
Recording the web tests..............................................................................................................102
Test replay......................................................................................................................................110
Data binding web tests.................................................................................................................117
Creating a data source for data binding............................................................................117
Test deployment considerations.......................................................................................124
Web test code generation...................................................................................................126
Extensibility through plug-ins...........................................................................................128
Alternative ways of recording web tests....................................................................................131
Considerations for load balancing / load balanced hardware...............................................134
Test automation...........................................................................................................................136
Creating a performance test scenario...............................................................................136
Putting automation in place.......................................................................................................147
Executing the load test........................................................................................................147
Collecting performance monitor data..............................................................................148
Collecting SQL Server usage statistics..............................................................................151
Clean up tasks......................................................................................................................154
Conclusion.....................................................................................................................................155
Chapter 6: Application Profiling..................................................................................................157
Types of profiling.........................................................................................................................157
Performance profiling.........................................................................................................159
Memory profiling.................................................................................................................161
When to start profiling................................................................................................................163
Reactive debugging..............................................................................................................164
Proactive analysis.................................................................................................................165
Technique validation...........................................................................................................165
Tools used for profiling...............................................................................................................166
CLRProfiler...........................................................................................................................166
Red Gate's ANTS Memory and Performance Profilers..................................................167
Microfocus DevPartner Studio Professional 9.1..............................................................171
Microsoft Visual Studio 2008 profiling tools..................................................................175
What to look for...........................................................................................................................179
Performance analysis...........................................................................................................179
Memory analysis..................................................................................................................181
Production / load test clues........................................................................................................183
General performance counters..........................................................................................183
Managing profiling results..........................................................................................................184
Comparing analysis runs....................................................................................................184
Pre-check-in requirements.................................................................................................184
Continuous integrated testing..........................................................................................184
Summary........................................................................................................................................185
Chapter 7: Performance Profiling...............................................................................................187
A caveat..........................................................................................................................................187
What the load test will tell you (and profilers can't)...............................................................188
Load testing .........................................................................................................................188
Where is it slow?...........................................................................................................................189
When to start testing...................................................................................................................191
Competing resources...................................................................................................................191
Types of profiler............................................................................................................................192
Sampling profiler.................................................................................................................192
Event-based profiling..........................................................................................................192
Concurrency (thread contention) profiling.....................................................................193
Instrumenting profilers......................................................................................................193
Choosing a profiler.......................................................................................................................193
What profilers can measure........................................................................................................194
What to look for...................................................................................................................194
Using the tools..............................................................................................................................197
ANTS Performance Profiler 5.............................................................................................197
DevPartner Studio Professional 9.1...................................................................................203
Performance timing profiler..............................................................................................203
Visual Studio Professional 2008/2010..............................................................................210
Visual Studio 2010 Team Edition......................................................................................219
SQL Profiler 2005/2008......................................................................................................222
Summary........................................................................................................................................224
Chapter 8: Memory Profiling.......................................................................................................225
Why memory matters..................................................................................................................225
The managed heap(s)...................................................................................................................225
Small Object Heap..............................................................................................................226
Optimizing garbage collection..........................................................................................227
Large Object Heap...............................................................................................................231
Finalizable objects................................................................................................................231
Profiling memory.........................................................................................................................234
Memory issues......................................................................................................................235
Using tools to uncover memory problems...............................................................................239
Test plans..............................................................................................................................239
ANTS Memory Profiler 5 ..................................................................................................240
Visual Studio 2008 Memory Profiler................................................................................247
DevPartner Studio Professional 9 ....................................................................................252
CLRProfiler...........................................................................................................................259
Summary.......................................................................................................................................264
Chapter 9: The Performance Testing Process...........................................................................265
Development processes and scheduling tests..........................................................................265
An ideal world......................................................................................................................265
Methodology.......................................................................................................................266
The reality............................................................................................................................268
A word about best practice................................................................................................268
Managing and monitoring performance changes.........................................................269
The entire performance picture........................................................................................273
Chapter 10: Common Areas for Performance Improvement...................................................275
Every application is different......................................................................................................275
Database access.............................................................................................................................275
The best and most efficient form of data access............................................................276
What to cache?.....................................................................................................................278
Indexing................................................................................................................................282
Database access abstractions............................................................................................284
Reflection......................................................................................................................................286
String manipulation....................................................................................................................289
Cryptographic functions.............................................................................................................293
Network call latency...................................................................................................................294
Key considerations when calling external resources.....................................................295
Synchronous vs. asynchronous.................................................................................................297
Asynchronous web pages...................................................................................................299
Web application specific..............................................................................................................303
Data binding..................................................................................................................................303
Output caching..............................................................................................................................311
web.config.......................................................................................................................................313
Conclusion....................................................................................................................................314
Chapter 11: Load Balancing...........................................................................................................315
What is load balancing and how does it help?..........................................................................315
Infrastructure considerations............................................................................................317
Application considerations................................................................................................320
Performance testing and load balancing..................................................................................323
Servers of different specifications in a farm....................................................................324
Windows Azure............................................................................................................................325
Conclusion....................................................................................................................................327
Chapter 12: Internet Information Server...................................................................................329
Background...................................................................................................................................329
IIS6 and the application pool.............................................................................................330
Under the hood....................................................................................................................330
Request listening (HTTP.sys)..............................................................................................331
Request processing (user mode)........................................................................................332
IIS common considerations.........................................................................................................335
Worker process recycling.....................................................................................................335
Bitness (32- or 64-bit application pools)...........................................................................339
Queue length.......................................................................................................................340
Pipeline mode......................................................................................................................340
CPU limiting.........................................................................................................................341
Processor affinity.................................................................................................................342
Health monitoring...............................................................................................................342
Rapid failure detection.......................................................................................................342
SSL server affinity and hardware acceleration.........................................................................343
How it works........................................................................................................................343
Load balancing and SSL......................................................................................................344
Optimizing performance with SSL...................................................................................345
HTTP compression......................................................................................................................346
TCP effect..............................................................................................................................346
CPU effect.............................................................................................................................347
Static and dynamic content compression........................................................................347
Static content................................................................................................................................350
HTTP headers................................................................................................................................351
Freshness and validation.....................................................................................................351
Content expiration..............................................................................................................352
Controlling content expiration in IIS................................................................................353
Tools.......................................................................................................................................354
Caching tip............................................................................................................................354
Reverse proxy................................................................................................................................355
IIS6 considerations..............................................................................................................355
IIS7 considerations..............................................................................................................355
Content Delivery Networks........................................................................................................356
CDN service providers........................................................................................................356
CDN and IIS7 Application Request Routing...................................................................357
Browser limitations.............................................................................................................357
Script CDNs..........................................................................................................................358
Summary........................................................................................................................................358
Chapter 13: HTTP Optimization..................................................................................................359
Tools...............................................................................................................................................359
Firebug...................................................................................................................................359
Fiddler....................................................................................................................................362
YSlow.....................................................................................................................................364
Internet Explorer Dev toolbar...........................................................................................371
JavaScript considerations............................................................................................................372
Use compression..................................................................................................................373
Minify scripts........................................................................................................................373
Adopt a caching policy........................................................................................................374
Place JavaScript files at the end of pages..........................................................................374
Reduce the number of scripts............................................................................................374
Use a Content Delivery Network (again).........................................................................375
JavaScript performance analysis........................................................................................375
CSS optimization.........................................................................................................................380
Externalize your style definitions......................................................................................381
Design your CSS for reuse..................................................................................................382
Keep your CSS concise........................................................................................................383
Use CSS instead of JavaScript if possible.........................................................................384
Avoid CSS expressions........................................................................................................385
Use CSS Sprites to improve HTTP performance............................................................385
Remove white space and comments before publishing................................................386
HTTP efficiency............................................................................................................................387
HTTP 404 responses...........................................................................................................387
HTTP 301/302 redirect responses.....................................................................................387
Image optimization......................................................................................................................388
Page weight...................................................................................................................................388
Reducing ViewState overhead...........................................................................................389
Control ID page bloat..........................................................................................................391
HTML white space..............................................................................................................391
Layouts using tables............................................................................................................392
AJAX considerations....................................................................................................................392
Problems with AJAX............................................................................................................393
Summary........................................................................................................................................398
A call to action......................................................................................................................398